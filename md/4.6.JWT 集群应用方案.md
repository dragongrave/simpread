> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.kancloud.cn](https://www.kancloud.cn/hanxt/springsecurity/2025946)

> HttpBasic、formLogin验证模式，RBAC权限模型，JWT、OAuth2等核心技术。验证码、图片验证码、单点登录及社交媒体登录等功能全覆盖。

> PS: 免费章节转载注明出处，本篇如果是收费章节禁止转载。违者必究。  
> 作者：[字母哥博客](http://www.zimug.com)  
> 本文出自：[Spring Security-JWT-OAuth 一本通](http://springboot.zimug.com)

一、回顾 JWT 授权与验证流程
----------------

在我们之前实现的 JWT 应用中，登录认证的 Controller 和令牌验证的 Filter 是在同一个应用中的。  
![](https://img.kancloud.cn/7b/97/7b97953b37861814c2c1d60025f70710_758x210.png)  
要想使用 JWT 访问资源需要

*   先使用用户名和密码，去 Controller 换取 JWT 令牌
*   然后才能进行资源的访问，资源接口的前端由一个 "JWT 验证 Filter" 负责校验令牌和授权访问。

二、集群应用
------

那我们可以思考一个问题，如果上面的应用部署两份形成集群应用，也就是 “应用 A” 和“应用 B”，代码是同一套代码。如果认证过程是在 “应用 A” 获取的 JWT 令牌，可以访问 “应用 B” 的接口资源么？（如下图）  
![](https://img.kancloud.cn/43/1a/431a50e475077926f0959c6866b39429_878x525.png)  
答案是：可以。因为两个应用中没有在内存 (session) 中保存中保存任何的状态信息，所有的信息都是去数据库里面现加载的。所以只要这两个应用，使用同一个数据库、同一套授权数据、同一个用于签名和解签的 secret。就可以实现 “应用 A” 的认证、在 “应用 B” 中被承认。  
那么另外一个问题来了，对于上面的集群应用，“应用 A”和 “应用 B” 实际上是一份代码部署两份。如果 “应用 A” 和“应用 B”是真正的两套代码的部署结果呢？答案仍然是可以。前提是你的认证 Controller 代码和鉴权 Filter 代码的实现逻辑是一样的、校验规则是一样的。使用同一个数据库、同一套授权数据、同一个用于签名和解签的 secret。所以 JWT 服务端应用可以很容易的扩展。

三、独立的授权服务
---------

基于 JWT 的这种无状态的灵活性，它很容易实现应用横向扩展。只要具备以下条件任何 JWT 的应用都可以整合为一个应用集群。

*   认证 Controller 代码统一
*   鉴权 Filter 代码统一、校验规则是一样的。
*   使用同一套授权数据
*   同一个用于签名和解签的 secret。

基于这个条件前提，我们完全可以把认证 Controller 代码单独抽取出来，形成 “认证服务器”。如下图所示：  
![](https://img.kancloud.cn/2c/e6/2ce6240475fe08b2466d9dc463795d31_994x541.png)  
或者我们还可以进一步把所有的 Jwt 验证鉴权 Filter 代码单独抽取出来，形成 “服务网关”，放在接口资源的前端。当然“服务网关” 的功能不只是鉴权、还要有请求转发的功能。

最后剩下的一系列的 “接口资源”，实际上就是我们常说的 “资源服务器”。