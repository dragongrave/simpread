> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.kancloud.cn](https://www.kancloud.cn/hanxt/springsecurity/2025941)

> HttpBasic、formLogin验证模式，RBAC权限模型，JWT、OAuth2等核心技术。验证码、图片验证码、单点登录及社交媒体登录等功能全覆盖。

> PS: 免费章节转载注明出处，本篇如果是收费章节禁止转载。违者必究。  
> 作者：[字母哥博客](http://www.zimug.com)  
> 本文出自：[Spring Security-JWT-OAuth 一本通](http://springboot.zimug.com)

一、基于 Session 的应用开发的缺陷
---------------------

在我们传统的 B\S 应用开发方式中，都是使用 session 进行状态管理的，比如说：保存登录、用户、权限等状态信息。这种方式的原理大致如下：  
![](https://img.kancloud.cn/fe/51/fe5186953a7a140844dee5dcb6cebf6e_1200x473.png)

*   用户登陆之后，将状态信息保存到 session 里面。服务端自动维护 sessionid，即将 sessionid 写入 cookie。
*   cookie 随着 HTTP 响应，被自动保存到浏览器端。
*   当用户再次发送 HTTP 请求，sessionid 随着 cookies 被带回服务器端
*   服务器端根据 sessionid，可以找回该用户之前保存在 session 里面的数据。

当然，这整个过程中，cookies 和 sessionid 都是服务端和浏览器端自动维护的。所以从编码层面是感知不到的，程序员只能感知到 session 数据的存取。但是，这种方式在有些情况下，是不适用的。

*   比如：非浏览器的客户端、手机移动端等等，因为他们没有浏览器自动维护 cookies 的功能。
*   比如：集群应用，同一个应用部署甲、乙、丙三个主机上，实现负载均衡应用，其中一个挂掉了其他的还能负载工作。要知道 session 是保存在服务器内存里面的，三个主机一定是不同的内存。那么你登录的时候访问甲，而获取接口数据的时候访问乙，就无法保证 session 的唯一性和共享性。

当然以上的这些情况我们都有方案 (如 redis 共享 session 等)，可以继续使用 session 来保存状态。但是还有另外一种做法就是不用 session 了，即开发一个无状态的应用，JWT 就是这样的一种方案。

二、JWT 是什么？
----------

笔者不想用比较高大上的名词解释 JWT（JSON web tokens），你可以认为 JWT 是一个加密后的接口访问密码，并且该密码里面包含用户名信息。这样既可以知道你是谁？又可以知道你是否可以访问应用？

![](https://img.kancloud.cn/35/ea/35eacfa907ea0d625bc36ff198e290d8_809x525.png)

*   首先，客户端需要向服务端申请 JWT 令牌，这个过程通常是登录功能。即：由用户名和密码换取 JWT 令牌。
*   当你访问系统其他的接口时，在 HTTP 的 header 中携带 JWT 令牌。header 的名称可以自定义，前后端对应上即可。
*   服务端解签验证 JWT 中的用户标识，根据用户标识从数据库中加载访问权限、用户信息等状态信息。

这就是 JWT，以及 JWT 在应用服务开发中的使用方法。

三、JWT 结构分析
----------

下图是我用在线的 JWT 解码工具，解码时候的截图。注意我这里用的是解码，不是解密。  
![](https://img.kancloud.cn/15/b7/15b76e670c51539f5aecaa1e847502d1_692x257.png)

从图中，我们可以看到 JWT 分为三个部分：

*   Header，这个部分通常是用来说明 JWT 使用的算法信息
*   payload，这个部分通常用于携带一些自定义的状态附加信息（重要的是用户标识）。但是注意这部分是可以明文解码的，所以注意是用户标识，而不应该是用户名或者其他用户信息。
*   signature，这部分是对前两部分数据的签名，防止前两部分数据被篡改。这里需要指定一个密钥 secret，进行签名和解签。

四、JWT 安全么？
----------

很多的朋友看到上面的这个解码文件，就会生出一个疑问？你都把 JWT 给解析了，而且 JWT 又这么的被大家广泛熟知，它还安全么？我用一个简单的道理说明一下：

*   JWT 就像是一把钥匙，用来开你家里的锁。用户把钥匙一旦丢了，家自然是不安全的。其实和使用 session 管理状态是一样的，一旦网络或浏览器被劫持了，肯定不安全。
*   signature 通常被叫做签名，而不是密码。比如：天王盖地虎是签名，宝塔镇河妖就被用来解签。字你全都认识，但是暗号只有知道的人才对得上。当然 JWT 中的暗号 secret 不会设计的像诗词一样简单。
*   JWT 服务端也保存了一把钥匙，就是暗号 secret。用来数据的签名和解签，secret 一旦丢失，所有用户都是不安全的。所以对于 IT 人员，更重要的是保护 secret 的安全。

如何加强 JWT 的安全性？

*   避免网络劫持，因为使用 HTTP 的 header 传递 JWT，所以使用 HTTPS 传输更加安全。这样在网络层面避免了 JWT 的泄露。
*   secret 是存放在服务器端的，所以只要应用服务器不被攻破，理论上 JWT 是安全的。因此要保证服务器的安全。
*   那么有没有 JWT 加密算法被攻破的可能？当然有。但是对于 JWT 常用的算法要想攻破，目前已知的方法只能是暴力破解，白话说就是 "试密码"。所以要定期更换 secret 并且保正 secret 的复杂度，等破解结果出来了，你的 secret 已经换了。

话说回来，如果你的服务器、或者你团队的内部人员出现漏洞，同样没有一种协议和算法是安全的。